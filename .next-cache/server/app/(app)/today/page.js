(()=>{var e={};e.id=2455,e.ids=[2455],e.modules={11185:e=>{"use strict";e.exports=require("mongoose")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},55315:e=>{"use strict";e.exports=require("path")},17360:e=>{"use strict";e.exports=require("url")},67727:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GlobalError:()=>r.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>c,routeModule:()=>m,tree:()=>o}),i(17245),i(64938),i(1121),i(90996),i(39707);var a=i(30170),n=i(45002),s=i(83876),r=i.n(s),d=i(66299),l={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>d[e]);i.d(t,l);let o=["",{children:["(app)",{children:["today",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(i.bind(i,17245)),"F:\\Coding\\Flowlane\\src\\app\\(app)\\today\\page.tsx"]}]},{loading:[()=>Promise.resolve().then(i.bind(i,64938)),"F:\\Coding\\Flowlane\\src\\app\\(app)\\today\\loading.tsx"]}]},{layout:[()=>Promise.resolve().then(i.bind(i,1121)),"F:\\Coding\\Flowlane\\src\\app\\(app)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(i.t.bind(i,90996,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(i.bind(i,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(i.bind(i,39707)),"F:\\Coding\\Flowlane\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(i.t.bind(i,90996,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(i.bind(i,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["F:\\Coding\\Flowlane\\src\\app\\(app)\\today\\page.tsx"],p="/(app)/today/page",u={require:i,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/(app)/today/page",pathname:"/today",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},84789:(e,t,i)=>{Promise.resolve().then(i.bind(i,66480))},35303:()=>{},70591:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});let a=(0,i(26323).Z)("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]])},74747:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});let a=(0,i(26323).Z)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},66480:(e,t,i)=>{"use strict";i.d(t,{TodayClient:()=>k});var a=i(97247),n=i(28964),s=i(79906),r=i(94830),d=i(99848),l=i(2125),o=i(21578),c=i(5519),p=i(17818),u=i(28852),m=i(87597),h=i(55757),x=i(70887),y=i(35224),f=i(87774),v=i(74747),g=i(70591),j=i(26323);let w=(0,j.Z)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),N=(0,j.Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);var A=i(75468),C=i(77081),I=i(62714);function b({initialItems:e}){let[t,i]=(0,n.useState)(e),[j,b]=(0,n.useState)([]),[k,D]=(0,n.useState)("all"),{addActivity:S}=(0,f.X)(),{contacts:T,setContacts:z,milestones:O,setMilestones:P,invoices:F,setInvoices:M,projects:_,setProjects:$}=(0,A.O)(),U="owner"===(0,C.q)(),E=new Date,R=(0,n.useMemo)(()=>t.filter(e=>{let t=(0,r.D)(e.dueAt),i=(0,d.R)(t,E),a=(0,l.K)(t,E),n=(0,o.A)(t,E)&&(0,d.R)(t,(0,c.E)(E,7));return"overdue"===k?i:"today"===k?a:"week"===k?n:"priority"!==k||i||a}),[t,k,E]),q=(0,n.useMemo)(()=>[...R].sort((e,t)=>(0,r.D)(e.dueAt).getTime()-(0,r.D)(t.dueAt).getTime()),[R]);async function Z(e){if("invoice"===e.type&&!U){p.A.error("Only the owner can do this.");return}if("followup"===e.type){let t=function(e){let t=T.find(t=>t.id===e),i=t?.followUpCadence??"none";return"weekly"===i?(0,c.E)(E,7).toISOString():"monthly"===i?(0,c.E)(E,30).toISOString():"custom"===i&&t?.followUpIntervalDays?(0,c.E)(E,t.followUpIntervalDays).toISOString():(0,c.E)(E,2).toISOString()}(e.entityId);try{await I.h.updateContact(e.entityId,{nextFollowUpAt:t}),z(i=>i.map(i=>i.id===e.entityId?{...i,nextFollowUpAt:t}:i)),i(t=>t.filter(t=>t.id!==e.id)),b(t=>[e,...t]),p.A.success("Marked as done."),S({entityType:e.entityType,entityId:e.entityId,action:"Marked done",meta:e.title})}catch{p.A.error("Unable to update follow-up.")}}if("milestone"===e.type)try{await I.h.updateMilestone(e.entityId,{status:"done"}),P(t=>t.map(t=>t.id===e.entityId?{...t,status:"done"}:t));let t=O.map(t=>t.id===e.entityId?{...t,status:"done"}:t);t.filter(e=>"done"===e.status).map(e=>e.projectId);let a=_.filter(e=>{let i=t.filter(t=>t.projectId===e.id);return 0!==i.length&&i.every(e=>"done"===e.status)});a.length>0&&(await Promise.all(a.map(e=>I.h.updateProject(e.id,{status:"completed"}))),$(e=>e.map(e=>a.find(t=>t.id===e.id)?{...e,status:"completed"}:e))),i(t=>t.filter(t=>t.id!==e.id)),b(t=>[e,...t]),p.A.success("Marked as done."),S({entityType:e.entityType,entityId:e.entityId,action:"Marked done",meta:e.title})}catch{p.A.error("Unable to update milestone.")}if("invoice"===e.type)try{await I.h.updateInvoice(e.entityId,{status:"paid"}),M(t=>t.map(t=>t.id===e.entityId?{...t,status:"paid"}:t)),i(t=>t.filter(t=>t.id!==e.id)),b(t=>[e,...t]),p.A.success("Marked as done."),S({entityType:e.entityType,entityId:e.entityId,action:"Marked done",meta:e.title})}catch{p.A.error("Unable to update invoice.")}}async function G(e,t){let a=(0,c.E)((0,r.D)(e.dueAt),t).toISOString();if("followup"===e.type){let i=(0,c.E)((0,r.D)(T.find(t=>t.id===e.entityId)?.nextFollowUpAt??e.dueAt),t).toISOString();try{await I.h.updateContact(e.entityId,{nextFollowUpAt:i}),z(t=>t.map(t=>t.id===e.entityId?{...t,nextFollowUpAt:i}:t))}catch{p.A.error("Unable to snooze follow-up.");return}}if("milestone"===e.type){let i=(0,c.E)((0,r.D)(e.dueAt),t).toISOString().slice(0,10);try{await I.h.updateMilestone(e.entityId,{dueDate:i}),P(t=>t.map(t=>t.id===e.entityId?{...t,dueDate:i}:t))}catch{p.A.error("Unable to snooze milestone.");return}}if("invoice"===e.type){let i=(0,c.E)((0,r.D)(e.dueAt),t).toISOString().slice(0,10);try{await I.h.updateInvoice(e.entityId,{dueDate:i}),M(t=>t.map(t=>t.id===e.entityId?{...t,dueDate:i}:t))}catch{p.A.error("Unable to snooze invoice.");return}}i(t=>t.map(t=>t.id===e.id?{...t,dueAt:a}:t)),p.A.message(`Snoozed for ${t} days.`),S({entityType:e.entityType,entityId:e.entityId,action:"Snoozed",meta:`+${t} days`})}let J=q.filter(e=>(0,d.R)((0,r.D)(e.dueAt),E)),W=q.filter(e=>(0,l.K)((0,r.D)(e.dueAt),E)),H=q.filter(e=>{let t=(0,r.D)(e.dueAt);return(0,o.A)(t,E)&&(0,d.R)(t,(0,c.E)(E,7))}),K=q.filter(e=>e.waitingClient);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-2xl font-semibold",children:"Today"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Focus on follow-ups, milestones, and overdue invoices."})]}),a.jsx("div",{className:"flex items-center gap-2",children:["all","priority","overdue","today","week"].map(e=>a.jsx(u.z,{size:"sm",variant:k===e?"secondary":"ghost",onClick:()=>D(e),children:"all"===e?"All":"priority"===e?"Priority":"overdue"===e?"Overdue":"today"===e?"Today":"This Week"},e))})]}),0===R.length?a.jsx("div",{className:"rounded-lg border border-dashed p-8 text-center text-sm text-muted-foreground",children:"You're clear for today."}):a.jsx("div",{className:"space-y-6",children:[{title:"Overdue",items:J},{title:"Due Today",items:W},{title:"Due This Week",items:H},{title:"Waiting on Client",items:K}].map(e=>e.items.length?(0,a.jsxs)("div",{className:"space-y-3",children:[a.jsx("h2",{className:"text-sm font-semibold",children:e.title}),e.items.map(e=>{let t=(0,r.D)(e.dueAt),i=(0,d.R)(t,E);return a.jsx(h.Zb,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("p",{className:"text-sm font-semibold",children:e.title}),i&&a.jsx(m.C,{variant:"danger",children:"Overdue"}),e.waitingClient&&a.jsx(m.C,{variant:"warning",children:"Waiting on client"})]}),a.jsx("p",{className:"text-xs text-muted-foreground",children:e.meta}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Due ",(0,y.mn)(e.dueAt)]})]}),a.jsx("div",{className:"flex flex-wrap items-center gap-2",children:(0,a.jsxs)(x.pn,{children:[(0,a.jsxs)(x.u,{children:[a.jsx(x.aJ,{asChild:!0,children:a.jsx(u.z,{size:"icon",variant:"ghost",onClick:()=>Z(e),children:a.jsx(v.Z,{className:"h-4 w-4"})})}),a.jsx(x._v,{children:"Mark done"})]}),(0,a.jsxs)(x.u,{children:[a.jsx(x.aJ,{asChild:!0,children:a.jsx(u.z,{size:"icon",variant:"ghost",onClick:()=>G(e,2),children:a.jsx(g.Z,{className:"h-4 w-4"})})}),a.jsx(x._v,{children:"Snooze +2 days"})]}),(0,a.jsxs)(x.u,{children:[a.jsx(x.aJ,{asChild:!0,children:a.jsx(u.z,{size:"icon",variant:"ghost",onClick:()=>G(e,7),children:a.jsx(g.Z,{className:"h-4 w-4"})})}),a.jsx(x._v,{children:"Snooze +7 days"})]}),(0,a.jsxs)(x.u,{children:[a.jsx(x.aJ,{asChild:!0,children:a.jsx(u.z,{asChild:!0,size:"icon",variant:"ghost",children:a.jsx(s.default,{href:e.href,children:a.jsx(w,{className:"h-4 w-4"})})})}),a.jsx(x._v,{children:"Open"})]}),e.waitingClient&&(0,a.jsxs)(x.u,{children:[a.jsx(x.aJ,{asChild:!0,children:a.jsx(u.z,{size:"icon",variant:"ghost",onClick:()=>(function(e){if(e.whatsapp){window.open(`https://wa.me/${e.whatsapp}`,"_blank");return}navigator.clipboard.writeText("Hi! Just checking in on the pending items. Let me know if you need anything from us."),p.A.success("Reminder copied to clipboard.")})(e),children:a.jsx(N,{className:"h-4 w-4"})})}),a.jsx(x._v,{children:"Ping client"})]})]})})]})},e.id)})]},e.title):null)}),j.length>0?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h2",{className:"text-sm font-semibold",children:["Completed (",j.length,")"]}),a.jsx("div",{className:"space-y-3",children:j.map(e=>a.jsx(h.Zb,{className:"p-4 opacity-70",children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-semibold",children:e.title}),a.jsx("p",{className:"text-xs text-muted-foreground",children:e.meta}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Done ",(0,y.mn)(new Date().toISOString())]})]}),a.jsx(u.z,{asChild:!0,size:"sm",variant:"ghost",children:a.jsx(s.default,{href:e.href,children:"Open"})})]})},`done-${e.id}`))})]}):null]})}function k(){let{contacts:e,milestones:t,invoices:i,projects:n}=(0,A.O)(),s=new Date,p=[...e.filter(e=>{let t=(0,r.D)(e.nextFollowUpAt);return(0,d.R)(t,s)||(0,l.K)(t,s)}).map(e=>({id:`followup-${e.id}`,type:"followup",title:`Follow-up: ${e.name}`,meta:`${e.company} \xb7 Due ${(0,y.mn)(e.nextFollowUpAt)}`,dueAt:e.nextFollowUpAt,href:`/contacts/${e.id}`,entityType:"contact",entityId:e.id,whatsapp:e.whatsapp})),...t.filter(e=>{if(!e.dueDate)return!1;let t=(0,r.D)(e.dueDate);return(0,d.R)(t,s)||(0,l.K)(t,s)||(0,o.A)(t,s)&&(0,d.R)(t,(0,c.E)(s,7))}).map(e=>{let t=n.find(t=>t.id===e.projectId);return{id:`milestone-${e.id}`,type:"milestone",title:e.title,meta:`${t?.title??"Project"} \xb7 Due ${(0,y.mn)(e.dueDate)}`,dueAt:e.dueDate,href:`/projects/${e.projectId}`,entityType:"milestone",entityId:e.id,waitingClient:"waiting_client"===e.status}}),...i.filter(e=>"overdue"===e.status).map(t=>{let i=e.find(e=>e.id===t.contactId);return{id:`invoice-${t.id}`,type:"invoice",title:`Overdue invoice ${t.invoiceNo}`,meta:`${i?.company??"Client"} \xb7 Due ${(0,y.mn)(t.dueDate)}`,dueAt:t.dueDate,href:`/invoices/${t.id}`,entityType:"invoice",entityId:t.id}})];return a.jsx(b,{initialItems:p})}},55757:(e,t,i)=>{"use strict";i.d(t,{Ol:()=>d,Zb:()=>r,aY:()=>o,ll:()=>l});var a=i(97247),n=i(28964),s=i(40677);let r=n.forwardRef(({className:e,...t},i)=>a.jsx("div",{ref:i,className:(0,s.cn)("rounded-xl border bg-card text-card-foreground shadow-sm",e),...t}));r.displayName="Card";let d=n.forwardRef(({className:e,...t},i)=>a.jsx("div",{ref:i,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",e),...t}));d.displayName="CardHeader";let l=n.forwardRef(({className:e,...t},i)=>a.jsx("h3",{ref:i,className:(0,s.cn)("text-lg font-semibold leading-none tracking-tight",e),...t}));l.displayName="CardTitle",n.forwardRef(({className:e,...t},i)=>a.jsx("p",{ref:i,className:(0,s.cn)("text-sm text-muted-foreground",e),...t})).displayName="CardDescription";let o=n.forwardRef(({className:e,...t},i)=>a.jsx("div",{ref:i,className:(0,s.cn)("p-6 pt-0",e),...t}));o.displayName="CardContent",n.forwardRef(({className:e,...t},i)=>a.jsx("div",{ref:i,className:(0,s.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},64938:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var a=i(72051),n=i(4615);function s(){return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[a.jsx(n.O,{className:"h-6 w-32"}),a.jsx(n.O,{className:"mt-2 h-4 w-64"})]}),a.jsx(n.O,{className:"h-10 w-72"}),a.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((e,t)=>a.jsx(n.O,{className:"h-20 w-full"},t))})]})}},17245:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});var a=i(72051);let n=(0,i(45347).createProxy)(String.raw`F:\Coding\Flowlane\src\components\today\TodayClient.tsx#TodayClient`);function s(){return a.jsx(n,{})}},4615:(e,t,i)=>{"use strict";i.d(t,{O:()=>s});var a=i(72051),n=i(39812);function s({className:e}){return a.jsx("div",{className:(0,n.cn)("animate-pulse rounded-md bg-muted",e)})}},39812:(e,t,i)=>{"use strict";i.d(t,{cn:()=>s});var a=i(36272),n=i(51472);function s(...e){return(0,n.m6)((0,a.W)(e))}},5519:(e,t,i)=>{"use strict";i.d(t,{E:()=>n});var a=i(82505);function n(e,t){let i=(0,a.Q)(e);if(isNaN(t)){var n;return n=NaN,e instanceof Date?new e.constructor(n):new Date(n)}return t&&i.setDate(i.getDate()+t),i}},21578:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});var a=i(82505);function n(e,t){let i=(0,a.Q)(e),n=(0,a.Q)(t);return i.getTime()>n.getTime()}}};var t=require("../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),a=t.X(0,[9379,6936,2960,401,4564,4080,3997,9324,5665,1181,7372,5411],()=>i(67727));module.exports=a})();