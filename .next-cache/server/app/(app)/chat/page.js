(()=>{var e={};e.id=2307,e.ids=[2307],e.modules={11185:e=>{"use strict";e.exports=require("mongoose")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},55315:e=>{"use strict";e.exports=require("path")},17360:e=>{"use strict";e.exports=require("url")},25637:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>c,routeModule:()=>x,tree:()=>d}),s(2862),s(1121),s(90996),s(39707);var a=s(30170),r=s(45002),n=s(83876),l=s.n(n),o=s(66299),i={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>o[e]);s.d(t,i);let d=["",{children:["(app)",{children:["chat",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,2862)),"F:\\Coding\\Flowlane\\src\\app\\(app)\\chat\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,1121)),"F:\\Coding\\Flowlane\\src\\app\\(app)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,90996,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,39707)),"F:\\Coding\\Flowlane\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,90996,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["F:\\Coding\\Flowlane\\src\\app\\(app)\\chat\\page.tsx"],p="/(app)/chat/page",u={require:s,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(app)/chat/page",pathname:"/chat",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},6240:(e,t,s)=>{Promise.resolve().then(s.bind(s,69106))},69106:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var a=s(97247),r=s(28964),n=s(17818),l=s(44211),o=s(28852),i=s(35224),d=s(75468),c=s(77081);function p({fullHeight:e=!1}){(0,c.q)();let{projects:t}=(0,d.O)(),[s,p]=(0,r.useState)(null),[u,x]=(0,r.useState)([]),[m,f]=(0,r.useState)(""),[h,g]=(0,r.useState)(!1),[y,b]=(0,r.useState)(["owner","editor"]),[j,v]=(0,r.useState)(!1),[N,w]=(0,r.useState)(null),[C,P]=(0,r.useState)(""),[S,_]=(0,r.useState)(0),k=(0,r.useRef)(null),T=(0,r.useRef)(null),[q,F]=(0,r.useState)(!0),R=(0,r.useMemo)(()=>{let e=C.toLowerCase();return y.filter(t=>t.toLowerCase().includes(e)).slice(0,6)},[y,C]),A=(0,r.useMemo)(()=>{let e=C.toLowerCase();return t.filter(t=>t.title.toLowerCase().includes(e)).slice(0,6)},[t,C]);function O(e){let t=m.slice(0,S),s=m.slice(S);f(t.replace(/(^|\s)([@#])([^\s]*)$/,`$1${e} `)+s),v(!1),w(null),P("")}async function $(){if(m.trim()){g(!0);try{let e=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entityType:"global",entityId:"workspace",body:m.trim()})}),t=await e.json();if(!t.success)throw Error("Unable to send message.");x(e=>[...e,t.data]),fetch("/api/notifications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:"New chat message",body:m.trim().slice(0,120),type:"chat_message",entityType:"global",entityId:"workspace"})}).catch(()=>void 0),f("")}catch{n.A.error("Unable to send message.")}finally{g(!1)}}}return(0,a.jsxs)("div",{className:["rounded-xl border bg-card p-4 text-xs text-muted-foreground",e?"flex h-full flex-col":""].join(" "),children:[a.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Team chat"}),a.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"Use @ to mention users, # to mention projects."}),(0,a.jsxs)("div",{className:["mt-3 space-y-2 overflow-y-auto",e?"flex-1 min-h-0":"max-h-40"].join(" "),ref:k,onScroll:e=>{let t=e.currentTarget;F(t.scrollHeight-t.scrollTop-t.clientHeight<20)},children:[0===u.length?a.jsx("p",{className:"text-xs text-muted-foreground",children:"No messages yet."}):(e?u:u.slice(-6)).map(e=>a.jsx("div",{className:`flex ${s&&e.senderId===s?"justify-end":"justify-start"}`,children:(0,a.jsxs)("div",{className:`max-w-[85%] rounded-md border px-2 py-2 ${s&&e.senderId===s?"bg-primary/10 text-foreground":"bg-background text-foreground"}`,children:[(0,a.jsxs)("div",{className:"text-[11px] text-muted-foreground",children:[e.senderName," \xb7 ",(0,i.p6)(e.createdAt)]}),a.jsx("div",{className:"text-xs text-foreground",children:e.body.split(/(@[a-zA-Z0-9_.-]+|#[a-zA-Z0-9_.-]+)/g).map((e,t)=>e.startsWith("@")?a.jsx("span",{className:"rounded bg-amber-200/30 px-1 text-amber-600",children:e},t):e.startsWith("#")?a.jsx("span",{className:"rounded bg-sky-200/30 px-1 text-sky-600",children:e},t):a.jsx("span",{children:e},t))})]})},e.id)),a.jsx("div",{ref:T})]}),(0,a.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,a.jsxs)("div",{className:"relative",children:[a.jsx(l.g,{value:m,onChange:e=>f(e.target.value),onClick:e=>_(e.target.selectionStart??0),onKeyUp:e=>_(e.target.selectionStart??0),placeholder:"Type a message...",rows:2}),j&&"@"===N&&a.jsx("div",{className:"absolute bottom-[110%] left-0 w-full rounded-lg border bg-background shadow-lg",children:0===R.length?a.jsx("div",{className:"px-3 py-2 text-xs text-muted-foreground",children:"No users found"}):R.map(e=>(0,a.jsxs)("button",{type:"button",className:"flex w-full items-center justify-between px-3 py-2 text-left text-xs hover:bg-muted/60",onClick:()=>O(`@${e.replace(/\s+/g,"_")}`),children:["@",e]},e))}),j&&"#"===N&&a.jsx("div",{className:"absolute bottom-[110%] left-0 w-full rounded-lg border bg-background shadow-lg",children:0===A.length?a.jsx("div",{className:"px-3 py-2 text-xs text-muted-foreground",children:"No projects found"}):A.map(e=>(0,a.jsxs)("button",{type:"button",className:"flex w-full items-center justify-between px-3 py-2 text-left text-xs hover:bg-muted/60",onClick:()=>O(`#${e.title.replace(/\s+/g,"_")}`),children:["#",e.title]},e.id))})]}),a.jsx("div",{className:"flex justify-end",children:a.jsx(o.z,{size:"sm",onClick:$,disabled:h||!m.trim(),children:h?"Sending...":"Send"})})]})]})}var u=s(55757);function x(){let[e,t]=(0,r.useState)(!1);return(0,a.jsxs)("div",{className:"flex h-[calc(100vh-120px)] flex-col space-y-6",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-2xl font-semibold",children:"Team Chat"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Mention @owner, @editor or #project to keep context."})]}),a.jsx(u.Zb,{className:"flex-1 min-h-0 p-6",children:e?a.jsx(p,{fullHeight:!0}):null})]})}},55757:(e,t,s)=>{"use strict";s.d(t,{Ol:()=>o,Zb:()=>l,aY:()=>d,ll:()=>i});var a=s(97247),r=s(28964),n=s(40677);let l=r.forwardRef(({className:e,...t},s)=>a.jsx("div",{ref:s,className:(0,n.cn)("rounded-xl border bg-card text-card-foreground shadow-sm",e),...t}));l.displayName="Card";let o=r.forwardRef(({className:e,...t},s)=>a.jsx("div",{ref:s,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",e),...t}));o.displayName="CardHeader";let i=r.forwardRef(({className:e,...t},s)=>a.jsx("h3",{ref:s,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight",e),...t}));i.displayName="CardTitle",r.forwardRef(({className:e,...t},s)=>a.jsx("p",{ref:s,className:(0,n.cn)("text-sm text-muted-foreground",e),...t})).displayName="CardDescription";let d=r.forwardRef(({className:e,...t},s)=>a.jsx("div",{ref:s,className:(0,n.cn)("p-6 pt-0",e),...t}));d.displayName="CardContent",r.forwardRef(({className:e,...t},s)=>a.jsx("div",{ref:s,className:(0,n.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},2862:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(45347).createProxy)(String.raw`F:\Coding\Flowlane\src\app\(app)\chat\page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[9379,6936,2960,401,4564,4080,3997,9324,5665,7372,5411],()=>s(25637));module.exports=a})();