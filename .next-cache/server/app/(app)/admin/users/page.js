(()=>{var e={};e.id=3387,e.ids=[3387],e.modules={11185:e=>{"use strict";e.exports=require("mongoose")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},55315:e=>{"use strict";e.exports=require("path")},17360:e=>{"use strict";e.exports=require("url")},30927:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>p,tree:()=>o}),s(9229),s(91267),s(1121),s(90996),s(39707);var a=s(30170),r=s(45002),n=s(83876),i=s.n(n),l=s(66299),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);s.d(t,d);let o=["",{children:["(app)",{children:["admin",{children:["users",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,9229)),"F:\\Coding\\Flowlane\\src\\app\\(app)\\admin\\users\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,91267)),"F:\\Coding\\Flowlane\\src\\app\\(app)\\admin\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,1121)),"F:\\Coding\\Flowlane\\src\\app\\(app)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,90996,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,39707)),"F:\\Coding\\Flowlane\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,90996,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["F:\\Coding\\Flowlane\\src\\app\\(app)\\admin\\users\\page.tsx"],m="/(app)/admin/users/page",u={require:s,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(app)/admin/users/page",pathname:"/admin/users",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},81407:(e,t,s)=>{Promise.resolve().then(s.bind(s,89447))},35303:()=>{},89447:(e,t,s)=>{"use strict";s.d(t,{AdminUsers:()=>f});var a=s(97247),r=s(44597),n=s(28964),i=s(17818),l=s(62714),d=s(28852),o=s(85426),c=s(55757),m=s(87597),u=s(58760),p=s(46444),x=s(69065),h=s(40677);function f({initialUsers:e,initialInvites:t,canManage:s,activeWorkspaceId:f,initialWorkspaceName:v,initialWorkspaceLogo:j,activeWorkspaceIsPersonal:g}){let[w,y]=(0,n.useState)(e),[b,N]=(0,n.useState)(t),[A,k]=(0,n.useState)(!1),[C,S]=(0,n.useState)(""),[U,P]=(0,n.useState)(""),[R,E]=(0,n.useState)("Editor"),[I,T]=(0,n.useState)(v),[z,F]=(0,n.useState)(j??""),[_,O]=(0,n.useState)(!1),[M,D]=(0,n.useState)(!1),q=(0,n.useRef)(null),[W,$]=(0,n.useState)(""),[G,H]=(0,n.useState)(!1),[Q,Z]=(0,n.useState)(""),[B,L]=(0,n.useState)(new Set),V=(0,n.useMemo)(()=>U.trim().length>3,[U]),Y=(0,n.useMemo)(()=>{let e=I.trim().length>=2&&I.trim()!==v.trim(),t=(z??"")!==(j??"");return e||t},[I,v,z,j]),J=(0,n.useMemo)(()=>!!s&&!g&&Q.trim()===v.trim(),[s,g,Q,v]);async function X(e=b){try{let[t,s]=await Promise.all([l.h.getUsers(),l.h.getInvites()]);y(t),N(s);let a=new Map(e.map(e=>[e.id,e])),r=s.filter(e=>{let t=a.get(e.id);return t&&"accepted"!==t.status&&"accepted"===e.status}).map(e=>e.acceptedUserId).filter(e=>!!e);r.length>0&&(L(e=>new Set([...e,...r])),i.A.success("Invite accepted. User added to team."),window.setTimeout(()=>{L(e=>{let t=new Set(e);return r.forEach(e=>t.delete(e)),t})},15e3))}catch{i.A.error("Unable to load team data.")}}async function K(){await X()}async function ee(){if(!s){i.A.error("Only owner can update team profile.");return}if(!f){i.A.error("Active workspace not found.");return}O(!0);try{let e=await l.h.updateWorkspace(f,{name:I.trim(),logoUrl:z});T(e.name),F(e.logoUrl??""),i.A.success("Team profile updated."),window.dispatchEvent(new CustomEvent("vaultflow-workspace-updated",{detail:{workspaceId:e.id,name:e.name}}))}catch(t){let e=t instanceof Error?t.message:"Unable to update team profile.";i.A.error(e)}finally{O(!1)}}async function et(e){if(s&&e){D(!0);try{let t=new FormData;t.append("files",e);let s=await fetch("/api/uploads",{method:"POST",body:t}),a=await s.json();if(!a?.success||!Array.isArray(a.data)||!a.data[0]?.url)throw Error(a?.error??"Upload failed.");F(String(a.data[0].url)),i.A.success("Team logo uploaded. Save to apply.")}catch(e){i.A.error(e instanceof Error?e.message:"Unable to upload team logo.")}finally{D(!1)}}}async function es(){if(!s){i.A.error("Only owner can invite users.");return}if(V){k(!0);try{let e=await l.h.createInvite({name:C.trim()||void 0,email:U.trim().toLowerCase(),role:R});N(t=>[e,...t]),S(""),P(""),E("Editor"),i.A.success("Invite created and stored.")}catch(t){let e=t instanceof Error?t.message:"Unable to create invite.";i.A.error(e)}finally{k(!1)}}}async function ea(e,t){if(!s){i.A.error("Only owner can update team users.");return}try{let s=await l.h.updateUser(e,t);y(t=>t.map(t=>t.id===e?{...t,...s}:t)),i.A.success("User updated.")}catch(t){let e=t instanceof Error?t.message:"Unable to update user.";i.A.error(e)}}async function er(e){if(!s){i.A.error("Only owner can remove team members.");return}if(e.isDirect){i.A.error("Primary workspace users cannot be removed from team membership.");return}$(e.id);try{await l.h.removeUserFromWorkspace(e.id),y(t=>t.filter(t=>t.id!==e.id)),i.A.success("Member removed from this team.")}catch(t){let e=t instanceof Error?t.message:"Unable to remove member.";i.A.error(e)}finally{$("")}}async function en(e){if(!s){i.A.error("Only owner can revoke invites.");return}try{await l.h.revokeInvite(e),N(t=>t.map(t=>t.id===e?{...t,status:"revoked"}:t)),i.A.success("Invite revoked.")}catch(t){let e=t instanceof Error?t.message:"Unable to revoke invite.";i.A.error(e)}}async function ei(){if(J&&f){H(!0);try{let e=await l.h.deleteWorkspace(f);i.A.success("Team deleted."),window.dispatchEvent(new CustomEvent("vaultflow-workspace-updated",{detail:{workspaceId:e.switchedWorkspaceId}})),window.location.reload()}catch(t){let e=t instanceof Error?t.message:"Unable to delete team.";i.A.error(e)}finally{H(!1)}}}async function el(e){try{await navigator.clipboard.writeText(e),i.A.success("Invite link copied.")}catch{i.A.error("Unable to copy link.")}}return(0,a.jsxs)("div",{className:"space-y-6",children:[s?(0,a.jsxs)(c.Zb,{className:"glass space-y-4 p-5",children:[(0,a.jsxs)("div",{children:[a.jsx("h2",{className:"text-sm font-semibold",children:"Team profile"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Owner can update active team name and logo."})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"flex h-12 w-12 items-center justify-center overflow-hidden rounded-full border bg-muted/50",children:z?a.jsx(r.default,{src:z,alt:I,width:48,height:48,className:"h-12 w-12 object-cover"}):a.jsx("span",{className:"text-sm font-semibold text-muted-foreground",children:(I||"W").charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("input",{ref:q,type:"file",accept:".png,.jpg,.jpeg,.webp",className:"hidden",onChange:e=>void et(e.target.files?.[0])}),a.jsx(d.z,{type:"button",variant:"outline",size:"sm",onClick:()=>q.current?.click(),disabled:M,children:M?"Uploading...":"Upload logo"}),z?a.jsx(d.z,{type:"button",variant:"ghost",size:"sm",onClick:()=>F(""),children:"Remove"}):null]})]}),(0,a.jsxs)("div",{className:"flex flex-1 flex-col gap-3 md:flex-row md:items-center",children:[a.jsx(o.I,{value:I,onChange:e=>T(e.target.value),disabled:_,placeholder:"Team name",className:"md:max-w-sm"}),a.jsx(d.z,{onClick:ee,disabled:!Y||_,children:_?"Saving...":"Save team profile"})]})]})]}):null,s?(0,a.jsxs)(c.Zb,{className:"glass space-y-4 p-5",children:[(0,a.jsxs)("div",{children:[a.jsx("h2",{className:"text-sm font-semibold",children:"Invite team member"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Send invite by email. Invite is stored in DB and member is added after signup."})]}),(0,a.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[a.jsx(o.I,{placeholder:"Full name (optional)",value:C,onChange:e=>S(e.target.value)}),a.jsx(o.I,{placeholder:"Email address",value:U,onChange:e=>P(e.target.value)}),(0,a.jsxs)(u.Ph,{value:R,onValueChange:e=>E(e),children:[a.jsx(u.i4,{children:a.jsx(u.ki,{placeholder:"Role"})}),(0,a.jsxs)(u.Bw,{children:[a.jsx(u.Ql,{value:"Owner",children:"Owner"}),a.jsx(u.Ql,{value:"Editor",children:"Editor"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("p",{className:"text-xs text-muted-foreground",children:"Invite expires in 7 days."}),a.jsx(d.z,{onClick:es,disabled:!V||A,children:A?"Sending...":"Send invite"})]})]}):(0,a.jsxs)(c.Zb,{className:"glass space-y-2 p-5",children:[a.jsx("h2",{className:"text-sm font-semibold",children:"Team access"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"You are viewing your team in read-only mode. Ask an owner to manage invites and roles."})]}),s&&!g?(0,a.jsxs)(c.Zb,{className:"space-y-3 border-destructive/40 p-5",children:[a.jsx("h2",{className:"text-sm font-semibold text-destructive",children:"Danger zone"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Delete this team permanently. Type the current team name to confirm."}),(0,a.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center",children:[a.jsx(o.I,{value:Q,onChange:e=>Z(e.target.value),placeholder:`Type "${v}" to confirm`,className:"md:max-w-sm"}),a.jsx(d.z,{variant:"destructive",onClick:ei,disabled:!J||G,children:G?"Deleting...":"Delete team"})]})]}):null,0===b.length?a.jsx(p.u,{title:"No invites yet",description:"Invite your first teammate by email."}):a.jsx("div",{className:"rounded-xl border bg-card",children:(0,a.jsxs)(x.iA,{children:[a.jsx(x.xD,{children:(0,a.jsxs)(x.SC,{children:[a.jsx(x.ss,{children:"Invite"}),a.jsx(x.ss,{children:"Role"}),a.jsx(x.ss,{children:"Status"}),a.jsx(x.ss,{className:"text-right",children:"Actions"})]})}),a.jsx(x.RM,{children:b.map(e=>{var t;return(0,a.jsxs)(x.SC,{className:"hover:bg-muted/40",children:[a.jsx(x.pj,{children:(0,a.jsxs)("div",{className:"flex flex-col",children:[a.jsx("span",{className:"font-medium",children:e.name||"Unnamed"}),a.jsx("span",{className:"text-xs text-muted-foreground",children:e.email})]})}),a.jsx(x.pj,{children:e.role}),a.jsx(x.pj,{children:a.jsx(m.C,{variant:"pending"===e.status?"secondary":"outline",children:"pending"===(t=e.status)?"Pending":"accepted"===t?"Accepted":"revoked"===t?"Revoked":"Expired"})}),a.jsx(x.pj,{className:"text-right",children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[a.jsx(d.z,{variant:"outline",size:"sm",onClick:()=>el(e.inviteUrl),children:"Copy link"}),s&&"pending"===e.status?a.jsx(d.z,{variant:"outline",size:"sm",onClick:()=>en(e.id),children:"Revoke"}):null]})})]},e.id)})})]})}),0===w.length?a.jsx(p.u,{title:"No active users yet",description:"Accepted invites will appear here."}):a.jsx("div",{className:"rounded-xl border bg-card",children:(0,a.jsxs)(x.iA,{children:[a.jsx(x.xD,{children:(0,a.jsxs)(x.SC,{children:[a.jsx(x.ss,{children:"User"}),a.jsx(x.ss,{children:"Role"}),a.jsx(x.ss,{children:"Status"}),a.jsx(x.ss,{className:"text-right",children:"Actions"})]})}),a.jsx(x.RM,{children:w.map(e=>(0,a.jsxs)(x.SC,{className:(0,h.cn)("hover:bg-muted/40",B.has(e.id)&&"bg-emerald-100/40 dark:bg-emerald-900/20"),children:[a.jsx(x.pj,{children:(0,a.jsxs)("div",{className:"flex flex-col",children:[a.jsx("span",{className:"font-medium",children:e.name}),a.jsx("span",{className:"text-xs text-muted-foreground",children:e.email})]})}),a.jsx(x.pj,{children:s?(0,a.jsxs)(u.Ph,{value:e.role,onValueChange:t=>ea(e.id,{role:t}),children:[a.jsx(u.i4,{className:"w-[140px]",children:a.jsx(u.ki,{placeholder:"Role"})}),(0,a.jsxs)(u.Bw,{children:[a.jsx(u.Ql,{value:"Owner",children:"Owner"}),a.jsx(u.Ql,{value:"Editor",children:"Editor"})]})]}):a.jsx("span",{children:e.role})}),a.jsx(x.pj,{children:a.jsx(m.C,{variant:e.isActive?"secondary":"outline",children:e.isActive?"Active":"Inactive"})}),a.jsx(x.pj,{className:"text-right",children:a.jsx("div",{className:"flex items-center justify-end gap-2",children:s?(0,a.jsxs)(a.Fragment,{children:[a.jsx(d.z,{variant:"outline",size:"sm",onClick:()=>ea(e.id,{isActive:!e.isActive}),children:e.isActive?"Deactivate":"Activate"}),e.isDirect||e.isSelf?null:a.jsx(d.z,{variant:"destructive",size:"sm",disabled:W===e.id,onClick:()=>er(e),children:W===e.id?"Removing...":"Remove"})]}):a.jsx("span",{className:"text-xs text-muted-foreground",children:"Read-only"})})})]},e.id))})]})}),a.jsx("div",{className:"flex justify-end",children:a.jsx(d.z,{variant:"ghost",size:"sm",onClick:K,children:"Refresh"})})]})}},46444:(e,t,s)=>{"use strict";s.d(t,{u:()=>i});var a=s(97247),r=s(28852),n=s(79175);function i({title:e,description:t,actionLabel:s="Quick Add"}){return(0,a.jsxs)("div",{className:"rounded-lg border border-dashed bg-background p-8 text-center",children:[a.jsx("p",{className:"text-sm font-semibold",children:e}),a.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:t}),a.jsx("div",{className:"mt-4 flex items-center justify-center",children:a.jsx(n.A,{children:a.jsx(r.z,{children:s})})})]})}},55757:(e,t,s)=>{"use strict";s.d(t,{Ol:()=>l,Zb:()=>i,aY:()=>o,ll:()=>d});var a=s(97247),r=s(28964),n=s(40677);let i=r.forwardRef(({className:e,...t},s)=>a.jsx("div",{ref:s,className:(0,n.cn)("rounded-xl border bg-card text-card-foreground shadow-sm",e),...t}));i.displayName="Card";let l=r.forwardRef(({className:e,...t},s)=>a.jsx("div",{ref:s,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",e),...t}));l.displayName="CardHeader";let d=r.forwardRef(({className:e,...t},s)=>a.jsx("h3",{ref:s,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight",e),...t}));d.displayName="CardTitle",r.forwardRef(({className:e,...t},s)=>a.jsx("p",{ref:s,className:(0,n.cn)("text-sm text-muted-foreground",e),...t})).displayName="CardDescription";let o=r.forwardRef(({className:e,...t},s)=>a.jsx("div",{ref:s,className:(0,n.cn)("p-6 pt-0",e),...t}));o.displayName="CardContent",r.forwardRef(({className:e,...t},s)=>a.jsx("div",{ref:s,className:(0,n.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},69065:(e,t,s)=>{"use strict";s.d(t,{RM:()=>d,SC:()=>o,iA:()=>i,pj:()=>m,ss:()=>c,xD:()=>l});var a=s(97247),r=s(28964),n=s(40677);let i=r.forwardRef(({className:e,...t},s)=>a.jsx("div",{className:"w-full overflow-auto",children:a.jsx("table",{ref:s,className:(0,n.cn)("w-full caption-bottom text-sm",e),...t})}));i.displayName="Table";let l=r.forwardRef(({className:e,...t},s)=>a.jsx("thead",{ref:s,className:(0,n.cn)("[&_tr]:border-b",e),...t}));l.displayName="TableHeader";let d=r.forwardRef(({className:e,...t},s)=>a.jsx("tbody",{ref:s,className:(0,n.cn)("[&_tr:last-child]:border-0",e),...t}));d.displayName="TableBody";let o=r.forwardRef(({className:e,...t},s)=>a.jsx("tr",{ref:s,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...t}));o.displayName="TableRow";let c=r.forwardRef(({className:e,...t},s)=>a.jsx("th",{ref:s,className:(0,n.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground",e),...t}));c.displayName="TableHead";let m=r.forwardRef(({className:e,...t},s)=>a.jsx("td",{ref:s,className:(0,n.cn)("p-4 align-middle",e),...t}));m.displayName="TableCell",r.forwardRef(({className:e,...t},s)=>a.jsx("caption",{ref:s,className:(0,n.cn)("mt-4 text-sm text-muted-foreground",e),...t})).displayName="TableCaption"},91267:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});var a=s(72051);function r({children:e}){return a.jsx("div",{className:"space-y-6",children:e})}},9229:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var a=s(72051),r=s(4767),n=s(73275);let i=(0,s(45347).createProxy)(String.raw`F:\Coding\Flowlane\src\components\admin\AdminUsers.tsx#AdminUsers`);async function l(){try{return(await (0,r.S)("/api/admin/users")).data??[]}catch{return[]}}async function d(){try{return(await (0,r.S)("/api/admin/invites")).data??[]}catch{return[]}}async function o(){try{return((await (0,r.S)("/api/workspaces")).data??[]).find(e=>e.isActive)??null}catch{return null}}async function c(){let[e,t,s,r]=await Promise.all([l(),d(),(0,n.ts)(),o()]),c=s?.role==="owner";return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-2xl font-semibold",children:"Team"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage access for Owners and Editors."})]}),a.jsx(i,{initialUsers:e,initialInvites:t,canManage:c,activeWorkspaceId:r?.id??"",initialWorkspaceName:r?.name??"My Workspace",initialWorkspaceLogo:r?.logoUrl??"",activeWorkspaceIsPersonal:!!r?.isPersonal})]})}},4767:(e,t,s)=>{"use strict";async function a(e){try{let t=await e.clone().json();if("string"==typeof t?.error&&t.error.trim())return t.error;if(t?.error)return JSON.stringify(t.error)}catch{}try{let t=await e.clone().text();if(t.trim())return t}catch{}return`API request failed: ${e.status}`}async function r(e,t){let r=function(){let{headers:e,cookies:t}=s(52845),a=e(),r=t(),n=a.get("x-forwarded-host")??a.get("host"),i=a.get("x-forwarded-proto")??"http";return{baseUrl:n?`${i}://${n}`:"http://localhost:3000",cookieHeader:r.getAll().map(e=>`${e.name}=${e.value}`).join("; ")}}(),n=r?.baseUrl??"",i=await fetch(`${n}${e}`,{...t,headers:{"Content-Type":"application/json",...r?.cookieHeader?{cookie:r.cookieHeader}:{},...t?.headers??{}},cache:"no-store"});if(!i.ok)throw Error(await a(i));return i.json()}s.d(t,{S:()=>r})}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[9379,6936,2960,401,4564,4080,3997,9324,5665,7372,5411],()=>s(30927));module.exports=a})();